{% extends "layout.html" %}
{% block content %}
<h2>Training</h2>

{% if project %}
<h3>{{ project.name }}</h3>

<div class="accordion-container">
    <!-- Auto Train Section -->
    <div class="accordion-section" id="auto-train-section">
        <div class="accordion-header active" data-section="auto-train">
            <span class="accordion-title">Auto Train</span>
            <span class="accordion-meta">
                <span class="completion-status">Completion: <span id="completion-pct">0</span>%</span>
            </span>
            <span class="accordion-arrow">&#9660;</span>
        </div>
        <div class="accordion-content" id="auto-train-content">
            <div class="auto-train-controls">
                {% set has_data = stats.files.total > 0 or stats.lines.total > 0 or stats.tables.total > 0 or stats.rows.total > 0 %}
                {% set has_training = stats.files.valid > 0 or stats.files.mixed > 0 or stats.files.research > 0 or stats.tables.valid > 0 or stats.tables.mixed > 0 or stats.tables.research > 0 %}
                <button type="button" id="auto-train-btn" class="auto-train-btn" {% if not has_data %}disabled{% endif %}>Auto Train</button>
                <button type="button" id="clear-training-btn" class="clear-training-btn" {% if not has_training %}disabled{% endif %}>Clear Training</button>
            </div>

            <div class="training-progress">
                <div class="progress-grid">
                    <div class="progress-card">
                        <h4>Files</h4>
                        <div class="progress-stats">
                            <div class="stat-row">
                                <span class="stat-label">Total:</span>
                                <span class="stat-value" id="files-total">{{ stats.files.total }}</span>
                            </div>
                            <div class="stat-row">
                                <span class="stat-label">Binary:</span>
                                <span class="stat-value" id="files-binary">{{ stats.files.binary }}</span>
                            </div>
                            <div class="stat-row">
                                <span class="stat-label">Code:</span>
                                <span class="stat-value" id="files-code">{{ stats.files.code }}</span>
                            </div>
                            <div class="stat-row">
                                <span class="stat-label">Valid:</span>
                                <span class="stat-value" id="files-valid">{{ stats.files.valid }}</span>
                            </div>
                            <div class="stat-row">
                                <span class="stat-label">Mixed:</span>
                                <span class="stat-value" id="files-mixed">{{ stats.files.mixed }}</span>
                            </div>
                            <div class="stat-row">
                                <span class="stat-label">Research:</span>
                                <span class="stat-value" id="files-research">{{ stats.files.research }}</span>
                            </div>
                        </div>
                    </div>

                    <div class="progress-card">
                        <h4>Lines of Code</h4>
                        <div class="progress-stats">
                            <div class="stat-row">
                                <span class="stat-label">Total:</span>
                                <span class="stat-value" id="lines-total">{{ stats.lines.total }}</span>
                            </div>
                            <div class="stat-row">
                                <span class="stat-label">Binary:</span>
                                <span class="stat-value" id="lines-binary">{{ stats.lines.binary }}</span>
                            </div>
                            <div class="stat-row">
                                <span class="stat-label">Code:</span>
                                <span class="stat-value" id="lines-code">{{ stats.lines.code }}</span>
                            </div>
                            <div class="stat-row">
                                <span class="stat-label">Valid:</span>
                                <span class="stat-value" id="lines-valid">{{ stats.lines.valid }}</span>
                            </div>
                            <div class="stat-row">
                                <span class="stat-label">Mixed:</span>
                                <span class="stat-value" id="lines-mixed">{{ stats.lines.mixed }}</span>
                            </div>
                            <div class="stat-row">
                                <span class="stat-label">Research:</span>
                                <span class="stat-value" id="lines-research">{{ stats.lines.research }}</span>
                            </div>
                        </div>
                    </div>

                    <div class="progress-card">
                        <h4>Database Tables</h4>
                        <div class="progress-stats">
                            <div class="stat-row">
                                <span class="stat-label">Total:</span>
                                <span class="stat-value" id="tables-total">{{ stats.tables.total }}</span>
                            </div>
                            <div class="stat-row">
                                <span class="stat-label">Binary:</span>
                                <span class="stat-value" id="tables-binary">{{ stats.tables.binary }}</span>
                            </div>
                            <div class="stat-row">
                                <span class="stat-label">Data:</span>
                                <span class="stat-value" id="tables-data">{{ stats.tables.data }}</span>
                            </div>
                            <div class="stat-row">
                                <span class="stat-label">Valid:</span>
                                <span class="stat-value" id="tables-valid">{{ stats.tables.valid }}</span>
                            </div>
                            <div class="stat-row">
                                <span class="stat-label">Mixed:</span>
                                <span class="stat-value" id="tables-mixed">{{ stats.tables.mixed }}</span>
                            </div>
                            <div class="stat-row">
                                <span class="stat-label">Research:</span>
                                <span class="stat-value" id="tables-research">{{ stats.tables.research }}</span>
                            </div>
                        </div>
                    </div>

                    <div class="progress-card">
                        <h4>Database Rows</h4>
                        <div class="progress-stats">
                            <div class="stat-row">
                                <span class="stat-label">Total:</span>
                                <span class="stat-value" id="rows-total">{{ stats.rows.total }}</span>
                            </div>
                            <div class="stat-row">
                                <span class="stat-label">Binary:</span>
                                <span class="stat-value" id="rows-binary">{{ stats.rows.binary }}</span>
                            </div>
                            <div class="stat-row">
                                <span class="stat-label">Data:</span>
                                <span class="stat-value" id="rows-data">{{ stats.rows.data }}</span>
                            </div>
                            <div class="stat-row">
                                <span class="stat-label">Valid:</span>
                                <span class="stat-value" id="rows-valid">{{ stats.rows.valid }}</span>
                            </div>
                            <div class="stat-row">
                                <span class="stat-label">Mixed:</span>
                                <span class="stat-value" id="rows-mixed">{{ stats.rows.mixed }}</span>
                            </div>
                            <div class="stat-row">
                                <span class="stat-label">Research:</span>
                                <span class="stat-value" id="rows-research">{{ stats.rows.research }}</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Manual Train Section -->
    <div class="accordion-section" id="manual-train-section">
        <div class="accordion-header" data-section="manual-train">
            <span class="accordion-title">Manual Train</span>
            <span class="accordion-arrow">&#9654;</span>
        </div>
        <div class="accordion-content collapsed" id="manual-train-content">
            <form action="/training" method="get" class="manual-train-form">
                <input type="hidden" name="project_id" value="{{ project.id }}">
                <div class="radio-group">
                    <label class="radio-label">
                        <input type="radio" name="data_type" value="files" {% if selected_data_type == 'files' or not selected_data_type %}checked{% endif %} onchange="this.form.submit()">
                        <span>Files</span>
                    </label>
                    <label class="radio-label">
                        <input type="radio" name="data_type" value="data" {% if selected_data_type == 'data' %}checked{% endif %} onchange="this.form.submit()">
                        <span>Data</span>
                    </label>
                </div>
            </form>

            {% if selected_data_type == 'files' or not selected_data_type %}
                {% if manual_train.dirty_file %}
                <div class="file-info">
                    <strong>File:</strong> {{ manual_train.dirty_file.file_name }}
                    <strong>Path:</strong> {{ manual_train.dirty_file.path }}
                    <span class="file-status status-{{ manual_train.dirty_file.status or 'unclassified' }}">{{ manual_train.dirty_file.status or 'unclassified' }}</span>
                </div>
                <div class="file-comparison">
                    <div class="file-panel">
                        <div class="panel-header">Dirty File</div>
                        <div class="file-content">
                            {% if manual_train.is_binary %}
                            <div class="binary-file-message">Binary File - Contents cannot be displayed</div>
                            {% elif manual_train.file_too_large %}
                            <div class="large-file-message">File too large to display ({{ manual_train.line_count }} lines)</div>
                            {% else %}
                                {% for line in manual_train.dirty_lines %}
                                <div class="code-line {% if line.status %}line-{{ line.status }}{% endif %}">
                                    <input type="checkbox" class="important-checkbox" data-row-id="{{ line.id }}" {% if line.important %}checked{% endif %}>
                                    <span class="line-number">{{ loop.index }}</span>
                                    <span class="line-text">{{ line.text or '' }}</span>
                                </div>
                                {% endfor %}
                                {% if not manual_train.dirty_lines %}
                                <div class="empty-message">No lines in file</div>
                                {% endif %}
                            {% endif %}
                        </div>
                    </div>
                    <div class="file-panel">
                        <div class="panel-header">Clean File</div>
                        <div class="file-content">
                            {% if manual_train.is_binary %}
                            <div class="binary-file-message">Binary File - Contents cannot be displayed</div>
                            {% elif manual_train.file_too_large %}
                            <div class="large-file-message">File too large to display</div>
                            {% elif manual_train.has_clean_match %}
                                {% if manual_train.clean_is_binary %}
                                <div class="binary-file-message">Binary File - Contents cannot be displayed</div>
                                {% elif manual_train.clean_file_too_large %}
                                <div class="large-file-message">File too large to display ({{ manual_train.clean_line_count }} lines)</div>
                                {% else %}
                                    {% for line in manual_train.clean_lines %}
                                    <div class="code-line">
                                        <span class="line-number">{{ loop.index }}</span>
                                        <span class="line-text">{{ line.text or '' }}</span>
                                    </div>
                                    {% endfor %}
                                    {% if not manual_train.clean_lines %}
                                    <div class="empty-message">No lines in file</div>
                                    {% endif %}
                                {% endif %}
                            {% else %}
                            <div class="no-match-message">No matching file</div>
                            {% endif %}
                        </div>
                    </div>
                </div>
                <div class="classification-controls">
                    <div class="radio-group classification-radio-group">
                        <label class="radio-label">
                            <input type="radio" name="file_status" value="valid" class="status-radio" data-type="file">
                            <span>Valid</span>
                        </label>
                        <label class="radio-label">
                            <input type="radio" name="file_status" value="bad" class="status-radio" data-type="file">
                            <span>Bad</span>
                        </label>
                    </div>
                    <button type="button" id="classify-btn" class="classify-btn" data-type="file">Submit</button>
                </div>
                <input type="hidden" id="current-file-id" value="{{ manual_train.dirty_file.id }}">
                {% else %}
                <div class="no-files-message">
                    <p>No files requiring manual review. All dirty files are classified as 'valid'.</p>
                </div>
                {% endif %}
            {% elif selected_data_type == 'data' %}
                {% if manual_train.dirty_table %}
                <div class="file-info">
                    <strong>Table:</strong> {{ manual_train.dirty_table.table_name }}
                    <span class="file-status status-{{ manual_train.dirty_table.status or 'unclassified' }}">{{ manual_train.dirty_table.status or 'unclassified' }}</span>
                </div>
                <div class="file-comparison" id="data-comparison">
                    <div class="file-panel">
                        <div class="panel-header">Dirty Data</div>
                        <div class="file-content">
                            {% for row in manual_train.dirty_rows %}
                            <div class="code-line {% if row.status %}line-{{ row.status }}{% endif %}">
                                <span class="line-number">{{ loop.index }}</span>
                                <span class="line-text"><strong>{{ row.field_name }}:</strong> {{ row.contents[:200] }}{% if row.contents|length > 200 %}...{% endif %}</span>
                            </div>
                            {% endfor %}
                            {% if not manual_train.dirty_rows %}
                            <div class="empty-message">No rows in table</div>
                            {% endif %}
                        </div>
                    </div>
                    <div class="file-panel">
                        <div class="panel-header">Clean Data</div>
                        <div class="file-content">
                            {% if manual_train.has_clean_table_match %}
                                {% for row in manual_train.clean_rows %}
                                <div class="code-line">
                                    <span class="line-number">{{ loop.index }}</span>
                                    <span class="line-text"><strong>{{ row.field_name }}:</strong> {{ row.contents[:200] }}{% if row.contents|length > 200 %}...{% endif %}</span>
                                </div>
                                {% endfor %}
                                {% if not manual_train.clean_rows %}
                                <div class="empty-message">No rows in table</div>
                                {% endif %}
                            {% else %}
                            <div class="no-match-message">No matching table</div>
                            {% endif %}
                        </div>
                    </div>
                </div>
                <div class="classification-controls">
                    <div class="radio-group classification-radio-group">
                        <label class="radio-label">
                            <input type="radio" name="table_status" value="valid" class="status-radio" data-type="table">
                            <span>Valid</span>
                        </label>
                        <label class="radio-label">
                            <input type="radio" name="table_status" value="bad" class="status-radio" data-type="table">
                            <span>Bad</span>
                        </label>
                    </div>
                    <button type="button" id="classify-btn" class="classify-btn" data-type="table">Submit</button>
                </div>
                <input type="hidden" id="current-table-id" value="{{ manual_train.dirty_table.id }}">
                {% else %}
                <div class="no-files-message">
                    <p>No tables requiring manual review. All dirty tables are classified as 'valid'.</p>
                </div>
                {% endif %}
            {% endif %}
        </div>
    </div>
</div>

<script>
(function() {
    var projectId = '{{ project.id }}';
    var btn = document.getElementById('auto-train-btn');
    var clearBtn = document.getElementById('clear-training-btn');
    var completionPct = document.getElementById('completion-pct');
    var protocol = window.location.protocol === 'https:' ? 'wss:' : 'ws:';
    var jobType = 'auto_train_' + projectId;

    // Clear Training button handler
    if (clearBtn) {
        clearBtn.addEventListener('click', function() {
            if (!confirm('Are you sure you want to clear all training data? This will reset all status fields to unclassified.')) {
                return;
            }

            clearBtn.disabled = true;
            clearBtn.textContent = 'Clearing...';

            fetch('/project/' + projectId + '/auto-train/clear', {
                method: 'POST'
            })
            .then(function(r) { return r.json(); })
            .then(function(data) {
                if (data.error) {
                    alert('Error: ' + data.error);
                    clearBtn.disabled = false;
                    clearBtn.textContent = 'Clear Training';
                    return;
                }

                // Reset all the display values to show cleared state
                document.getElementById('files-valid').textContent = '0';
                document.getElementById('files-mixed').textContent = '0';
                document.getElementById('files-research').textContent = '0';
                document.getElementById('lines-valid').textContent = '0';
                document.getElementById('lines-mixed').textContent = '0';
                document.getElementById('lines-research').textContent = '0';
                document.getElementById('tables-valid').textContent = '0';
                document.getElementById('tables-mixed').textContent = '0';
                document.getElementById('tables-research').textContent = '0';
                document.getElementById('rows-valid').textContent = '0';
                document.getElementById('rows-mixed').textContent = '0';
                document.getElementById('rows-research').textContent = '0';
                completionPct.textContent = '0';

                clearBtn.textContent = 'Cleared!';
                setTimeout(function() {
                    clearBtn.textContent = 'Clear Training';
                    clearBtn.disabled = true; // Stay disabled since no training data
                }, 2000);
            })
            .catch(function(err) {
                alert('Error clearing training data: ' + err);
                clearBtn.disabled = false;
                clearBtn.textContent = 'Clear Training';
            });
        });
    }

    // Accordion functionality
    var headers = document.querySelectorAll('.accordion-header');
    var STORAGE_KEY = 'training_accordion_section';

    function openSection(section) {
        // Close all sections
        headers.forEach(function(h) {
            h.classList.remove('active');
            h.querySelector('.accordion-arrow').innerHTML = '&#9654;';
        });
        document.querySelectorAll('.accordion-content').forEach(function(c) {
            c.classList.add('collapsed');
        });

        // Open the specified section
        var header = document.querySelector('.accordion-header[data-section="' + section + '"]');
        var content = document.getElementById(section + '-content');
        if (header && content) {
            header.classList.add('active');
            header.querySelector('.accordion-arrow').innerHTML = '&#9660;';
            content.classList.remove('collapsed');
        }
    }

    headers.forEach(function(header) {
        header.addEventListener('click', function() {
            var section = this.getAttribute('data-section');
            var isActive = this.classList.contains('active');

            // Close all sections
            headers.forEach(function(h) {
                h.classList.remove('active');
                h.querySelector('.accordion-arrow').innerHTML = '&#9654;';
            });
            document.querySelectorAll('.accordion-content').forEach(function(c) {
                c.classList.add('collapsed');
            });

            // Open clicked section if it wasn't already active
            if (!isActive) {
                this.classList.add('active');
                this.querySelector('.accordion-arrow').innerHTML = '&#9660;';
                document.getElementById(section + '-content').classList.remove('collapsed');
                // Save to localStorage
                localStorage.setItem(STORAGE_KEY, section);
            } else {
                // Section was closed, remove from localStorage
                localStorage.removeItem(STORAGE_KEY);
            }
        });
    });

    // Restore last opened section from localStorage
    var savedSection = localStorage.getItem(STORAGE_KEY);
    if (savedSection) {
        openSection(savedSection);
    }

    function updateProgressFromData(data) {
        // Update files
        document.getElementById('files-total').textContent = data.files.total;
        document.getElementById('files-binary').textContent = data.files.binary;
        document.getElementById('files-code').textContent = data.files.code;
        document.getElementById('files-valid').textContent = data.files.valid;
        document.getElementById('files-mixed').textContent = data.files.mixed;
        document.getElementById('files-research').textContent = data.files.research;

        // Update lines
        document.getElementById('lines-total').textContent = data.lines.total;
        document.getElementById('lines-binary').textContent = data.lines.binary;
        document.getElementById('lines-code').textContent = data.lines.code;
        document.getElementById('lines-valid').textContent = data.lines.valid;
        document.getElementById('lines-mixed').textContent = data.lines.mixed;
        document.getElementById('lines-research').textContent = data.lines.research;

        // Update tables
        document.getElementById('tables-total').textContent = data.tables.total;
        document.getElementById('tables-binary').textContent = data.tables.binary;
        document.getElementById('tables-data').textContent = data.tables.data;
        document.getElementById('tables-valid').textContent = data.tables.valid;
        document.getElementById('tables-mixed').textContent = data.tables.mixed;
        document.getElementById('tables-research').textContent = data.tables.research;

        // Update rows
        document.getElementById('rows-total').textContent = data.rows.total;
        document.getElementById('rows-binary').textContent = data.rows.binary;
        document.getElementById('rows-data').textContent = data.rows.data;
        document.getElementById('rows-valid').textContent = data.rows.valid;
        document.getElementById('rows-mixed').textContent = data.rows.mixed;
        document.getElementById('rows-research').textContent = data.rows.research;
    }

    function observeJob(jobId) {
        var wsUrl = protocol + '//' + window.location.host + '/job/' + jobId + '/ws';
        var ws = new WebSocket(wsUrl);

        ws.onopen = function() {
            btn.disabled = true;
            btn.textContent = 'Training...';
        };

        ws.onmessage = function(event) {
            var msg = JSON.parse(event.data);

            if (msg.type === 'update') {
                // Update completion percentage
                completionPct.textContent = msg.progress || 0;

                // Parse progress data from message field
                if (msg.message) {
                    try {
                        var progressData = JSON.parse(msg.message);
                        if (progressData.data) {
                            updateProgressFromData(progressData.data);
                        }
                    } catch (e) {
                        // Message is not JSON, just show as status
                        btn.textContent = msg.message.length > 20 ? msg.message.substring(0, 20) + '...' : msg.message;
                    }
                }

            } else if (msg.type === 'done') {
                if (msg.status === 'completed') {
                    btn.textContent = 'Done!';
                    completionPct.textContent = '100';
                    setTimeout(function() {
                        btn.disabled = false;
                        btn.textContent = 'Auto Train';
                    }, 2000);
                } else if (msg.status === 'failed') {
                    alert('Error: ' + (msg.error_details || msg.message || 'Training failed'));
                    btn.disabled = false;
                    btn.textContent = 'Auto Train';
                } else if (msg.status === 'cancelled') {
                    btn.disabled = false;
                    btn.textContent = 'Auto Train';
                }

            } else if (msg.type === 'error') {
                alert('Error: ' + msg.message);
                btn.disabled = false;
                btn.textContent = 'Auto Train';
            }
        };

        ws.onerror = function() {
            // Fall back to polling
            pollJobStatus(jobId);
        };

        ws.onclose = function(event) {
            if (!event.wasClean && btn.disabled) {
                setTimeout(function() { checkAndReconnect(); }, 2000);
            }
        };
    }

    function pollJobStatus(jobId) {
        fetch('/job/' + jobId)
            .then(function(r) { return r.json(); })
            .then(function(data) {
                if (data.status === 'running' || data.status === 'pending') {
                    completionPct.textContent = data.progress || 0;

                    // Parse progress data from message
                    if (data.message) {
                        try {
                            var progressData = JSON.parse(data.message);
                            if (progressData.data) {
                                updateProgressFromData(progressData.data);
                            }
                        } catch (e) {}
                    }

                    setTimeout(function() { pollJobStatus(jobId); }, 1000);
                } else if (data.status === 'completed') {
                    completionPct.textContent = '100';
                    btn.textContent = 'Done!';
                    setTimeout(function() {
                        btn.disabled = false;
                        btn.textContent = 'Auto Train';
                    }, 2000);
                } else {
                    btn.disabled = false;
                    btn.textContent = 'Auto Train';
                }
            })
            .catch(function() {
                btn.disabled = false;
                btn.textContent = 'Auto Train';
            });
    }

    function checkAndReconnect() {
        fetch('/project/' + projectId + '/job/' + jobType)
            .then(function(r) { return r.json(); })
            .then(function(data) {
                if (data.status === 'running' || data.status === 'pending') {
                    // Only update UI if job was started within last 5 minutes
                    // This prevents stale jobs from overwriting current stats
                    var jobStart = new Date(data.started_at || data.created_at);
                    var now = new Date();
                    var ageMinutes = (now - jobStart) / 1000 / 60;

                    if (ageMinutes < 5) {
                        completionPct.textContent = data.progress || 0;
                        btn.disabled = true;
                        btn.textContent = 'Training...';
                        observeJob(data.id);
                    }
                    // If job is stale (>5 min old and still "running"), ignore it
                }
            })
            .catch(function() {});
    }

    btn.addEventListener('click', function() {
        if (!projectId) {
            alert('Please select a project first');
            return;
        }

        btn.disabled = true;
        btn.textContent = 'Starting...';

        fetch('/project/' + projectId + '/auto-train/start', {
            method: 'POST'
        })
        .then(function(r) { return r.json(); })
        .then(function(data) {
            if (data.error) {
                alert('Error: ' + data.error);
                btn.disabled = false;
                btn.textContent = 'Auto Train';
                return;
            }

            completionPct.textContent = '0';
            observeJob(data.job_id);
        })
        .catch(function(err) {
            alert('Error starting training: ' + err);
            btn.disabled = false;
            btn.textContent = 'Auto Train';
        });
    });

    // On page load, check for running jobs
    checkAndReconnect();

    // Manual Train - Classification handling for both files and tables
    var classifyBtn = document.getElementById('classify-btn');
    var fileIdInput = document.getElementById('current-file-id');
    var tableIdInput = document.getElementById('current-table-id');

    if (classifyBtn) {
        classifyBtn.addEventListener('click', function() {
            var dataType = this.getAttribute('data-type');
            var apiUrl, itemId, statusRadioName;

            if (dataType === 'file' && fileIdInput) {
                itemId = fileIdInput.value;
                apiUrl = '/api/file/' + itemId + '/classify';
                statusRadioName = 'file_status';
            } else if (dataType === 'table' && tableIdInput) {
                itemId = tableIdInput.value;
                apiUrl = '/api/db-table/' + itemId + '/classify';
                statusRadioName = 'table_status';
            } else {
                return;
            }

            // Get selected status
            var selectedRadio = document.querySelector('input[name="' + statusRadioName + '"]:checked');
            if (!selectedRadio) {
                alert('Please select Valid or Bad');
                return;
            }
            var status = selectedRadio.value;

            // Collect all checked important checkboxes (only for files)
            var importantRowIds = [];
            if (dataType === 'file') {
                document.querySelectorAll('.important-checkbox:checked').forEach(function(cb) {
                    importantRowIds.push(parseInt(cb.getAttribute('data-row-id')));
                });
            }

            // Disable button while processing
            classifyBtn.disabled = true;
            classifyBtn.textContent = 'Submitting...';

            fetch(apiUrl, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    status: status,
                    important_row_ids: importantRowIds
                })
            })
            .then(function(r) { return r.json(); })
            .then(function(data) {
                if (data.error) {
                    alert('Error: ' + data.error);
                    classifyBtn.disabled = false;
                    classifyBtn.textContent = 'Submit';
                    return;
                }

                // Success - reload to show next item
                window.location.reload();
            })
            .catch(function(err) {
                alert('Error classifying: ' + err);
                classifyBtn.disabled = false;
                classifyBtn.textContent = 'Submit';
            });
        });
    }
})();
</script>

{% else %}
<p>Select a project from the menu above to begin training.</p>
{% endif %}

{% endblock %}
